<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body * {
      font-weight: 200;
      background-image: url("floorplan.png");
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;  
    }

    #heatmapContainerWrapper {
      width: 100%;
      height: 100%;
      position: absolute;
      background: rgba(0, 0, 0, .1);
    }

    #heatmapContainer {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <!-- HTML ELEMENTS -->
  <div id="heatmapContainerWrapper">
    <div id="heatmapContainer"></div>
  </div>
  <script src="./heatmap.min.js"></script>

  <script>
    /*   ---  MAIN  ---   */
    window.onload = function () {
      // Retrieve params
      const loc = window.location.toString().split('?')[1],
         params = JSON.parse(
          '{"' + decodeURI(loc.replace(/&/g, "\",\"").replace(/=/g, "\":\"")) + '"}'
         );

      // create a heatmap instance
      const heatmap = h337.create({
        container: document.getElementById('heatmapContainer'),
        maxOpacity: .5,
        radius: 10,
        blur: .75
      });

      // boundaries for data generation
      const width = (+window.getComputedStyle(document.body).width.replace(/px/, '')),
            height = (+window.getComputedStyle(document.body).height.replace(/px/, ''));
      // get data
      fetch('https://heatroom-api.azurewebsites.net/api/heatmap')
        .then(res => res.json())
        .then(json => {
          var hits = json[0].hits,
              data = [],
              min = Math.min(...hits.flat()),
              max = Math.max(...hits.flat())
            ;
          
          hits.forEach(element =>
            data.push({
              x: (element[0] * width) >> 0,
              y: (element[1] * height) >> 0,
              value: 100,
              radius: 10
            })
          );

          heatmap.setData({
            min: 0,
            max: 1,
            data: data
          });
          return;
        })
        .catch(err => console.log(err));
    };
  </script>
</body>
</html>